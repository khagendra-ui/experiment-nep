@startuml SOS Emergency Alert Sequence

actor Tourist
participant "React Frontend" as Frontend
participant "Geolocation API" as GPS
participant "FastAPI Backend" as Backend
participant "MongoDB" as DB
participant "SMTP Server" as Email
actor "Emergency Services" as Emergency
actor Admin

== Emergency Situation ==
Tourist -> Frontend: Click SOS Button
Frontend -> Frontend: Show confirmation dialog
Tourist -> Frontend: Confirm emergency

Frontend -> GPS: Get current location
GPS --> Frontend: Latitude & Longitude

Frontend --> Tourist: Show emergency form

Tourist -> Frontend: Select emergency type\n(medical/accident/lost)\n+ optional message

Frontend -> Backend: POST /api/sos
note right
  {
    latitude: 27.7172,
    longitude: 85.3240,
    user_name: "John Doe",
    user_email: "john@example.com",
    user_phone: "+977-9841234567",
    emergency_type: "medical",
    message: "Altitude sickness"
  }
end note

== Process SOS Alert ==
Backend -> Backend: Generate alert ID\n& Google Maps link
Backend -> DB: Create SOS alert record
note right
  Status: active
  Created timestamp
  GPS coordinates
end note
DB --> Backend: Alert saved

Backend -> DB: Query nearest\nemergency contacts
DB --> Backend: Emergency contacts list
Backend --> Frontend: SOS sent +\nnearest contacts

== Notifications ==
Backend -> Email: Send emergency email\n(background task)
note right of Email
  To: Admin & Emergency Services
  Subject: ðŸš¨ EMERGENCY SOS ALERT
  Body: Location, user info,
        emergency type, Google Maps link
end note
Email --> Emergency: ðŸš¨ Email notification
Email --> Admin: ðŸš¨ Email notification

Frontend --> Tourist: âœ… Help is on the way!\n+ Emergency contact numbers

== Admin Monitors Alert ==
Admin -> Frontend: Login to admin panel
Frontend -> Backend: GET /api/admin/sos-alerts
Backend -> Auth: Verify admin token
Backend -> DB: Query active SOS alerts
DB --> Backend: Alerts list
Backend --> Frontend: SOS alerts
Frontend --> Admin: Display alerts map\n& list view

== Emergency Response ==
Emergency -> Emergency: Dispatch rescue team\nto GPS coordinates

== Resolve Alert ==
Admin -> Frontend: Update alert status
Frontend -> Backend: PATCH /api/admin/sos-alerts/{id}\n{status: "resolved"}
Backend -> DB: Update alert
note right
  Status: resolved
  Resolved timestamp
end note
DB --> Backend: Updated
Backend --> Frontend: Alert resolved
Frontend --> Admin: Status updated

Tourist -> Frontend: Check alert status
Frontend --> Tourist: Alert resolved âœ…

@enduml
